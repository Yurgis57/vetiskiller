# vetiskiller
Automatic confirmation of Mercury/Vetis certificates 
============ Общие сведения: ====================================================

Программа VetisKiller.exe предназначена для автоматического гашения Ветеринарных сопроводительных 
документов (ВСД), выставленных на одно "Предприятие" ("enterprise") одного "Хозяйствующего
субъекта" (ХС, "Business Entity").

Программа рассчитана на все версии MS Windows, начиная с XP. Проверялась на WinXP SP3,
Win7, Win10, WinServer 2012 R2. На момент написания данного документа ей было погашено более
30 тысяч ВСД.

Гашение ВСД осуществляется только полностью, анализируются только даты. После запуска функции 
"Погасить входящие серификаты" программа начинает в бесконечном цикле запрашивать систему о 
наличии входящих ВСД и гасит их по мере появления со скоростью около 200 ВСД в час. Для
завершения работы программы надо нажать клавишу Esc, или просто закрыть окно.
В случае, если какие-либо ВСД должны быть погашены не полностью, их гашение следует
осуществлять до того как программа до них доберется, средствами Web-интерфейса или 
системы управления предприятием. Для отсрочки автоматического гашения можно настроить
параметр dOffset.

НЕ ГАСЯТСЯ:
-	ВСД, чье время еще не пришло ("ВСД из будущего")
-	ВСД с просроченным товаром

Программа поставляется в двух вариантах -- бесплатном и безлимитном. Единственное
различие между ними -- ограничение на гашение не более 40 ВСД в сутки у бесплатной
версии. 

============ Ограничение ответственности: =======================================

Программа предоставляется Пользователю по принципу “как есть”, и может содержать в себе ошибки. 
Разработчик ни при каких обстоятельствах не несет ответственности перед Пользователем или иной 
третьей стороной за связанные с установкой или использованием Программы прямые, косвенные или 
последующие убытки, разрушения, травмы или расходы любого вида, включая, но не ограничиваясь, 
потерю производительности, прибылей или контрактов, штрафы, или убытки вследствие потери или 
порчи данных. 

============ Предварительные пляски: ============================================

Прежде чем что-либо запускать, необходимо выполнить следующие действия:

1.  Скачать дистрибутив программы в отдельный каталог (папку) на любом диске. 
2.  Получить доступ к Тестовому контуру Ветис.API на https://t2-aplms.vetrf.ru/pub/.
    Это займет несколько дней.
3.  Прописать полученные реквизиты доступа к тестовому контуру в файл Vetis.ini
4.  Создать в Тестовом контуре Ваше "предприятие" ("Enterprise") и привязать его к Вашему 
    "Хозяйствующему субъекту" (ХС)
5.  Раздобыть у добрых людей несколько ВСД, выставленных в тестовом контуре на Ваш ХС и
    предприятие (можно на http://vetrf.ru/vetrf-forum/posts/list/375/7133.page#82661)
6.  Запустить программу VetisKiller.exe, выбрать в меню "Проверить наличие непогашенных сертификатов".
    Если выдается сообщение об ошибке -- проверить настройки. Если число ВСД = 0 - см. пункт 5.
7.  Выбрать в меню "Погасить входящие серификаты". 
8.  Получить доступ к Боевому ("продуктивному") контуру Ветис.API. Это займет еще несколько дней
    (см. ссылку на странице https://t2-aplms.vetrf.ru/pub/)
9.  Скопировать или переименовать файл VetisReal.ini в Vetis.ini
10. Прописать полученные реквизиты доступа к боевому контуру в файл Vetis.ini
11. Повторить пункты 6 и 7.

Если Вам некогда заниматься всей этой гимнастикой, обращайтесь к нам. Все, кроме подачи заявлений,
мы готовы сделать для Вас за 1500 руб. (а при покупке безлимитной версии -- бесплатно).

Если у Вас накопилось много непогашенных ВСД, и Вы хотите пользоваться бесплатной версией -- мы 
готовы разово погасить весь накопившийся объем по цене 0.2 руб за один ВСД. Пользователям
безлимитной версии достаточно просто запустить функцию "Погасить входящие серификаты", программа
погасит все, что к Вам приходило, со скоростью около 200 ВСД в час.

============ Назначение параметров Vetis.ini: ===================================

Параметры, одинаковые для тестового и боевого контура Ветис:

iLog=7			Управление логами системы, сохраняемыми в подкаталоге \log
				n - сумма желаемых параметров:
				1	Ошибки
				2	Стандартные сообщения системы
				4	Расширенные сообщения системы
				16	Сохранение в логе всех принимаемых/получаемых сообщений 
					(без надобности лучше не включать)
				Например, 23 = 1 + 2 + 4 + 16 (сохранение всех данных обмена)
XMLHeader=		Стандартный Header для отправляемых сообщений
Service=		Тип и версия сервиса Ветис
NVDList=30		Число ВСД, считываемое за 1 цикл работы программы (max 100)

Параметры, различающиеся для тестового и боевого контура Ветис:

Endpoint=		EndPoint для Vetis ApplicationManagement
MercLogin=		Ваша учетная запись (Account Name) из письма от Ветис.Паспорт (пароль не нужен)
ApiLogin=L:P		L - Login, P - Password из письма "Предоставление доступа к Ветис.API" 
apikey=			Ваш APIKey из письма "Предоставление доступа к Ветис.API" 
BusinessEntityGuid=	Ваш IssuerID (он же ХС, "Хозяйствующий Субъект") из письма "Предоставление доступа к Ветис.API" 
EnterpriseGuid=		Ваше предприятие (площадка). В тестовом контуре ее надо создать и привязать к Вашему ХС.
			В боевом контуре она уже есть, коль скоро к Вам на нее приходят реальные ВСД.
dOffset=0		Максимальная допустимая дата у гасимого ВСД. Задается в числе дней относительно текущей даты. 
			Дата самого ВСД определяется как максимальная из даты ТТН (WayBill) и даты последнего изменения
			ВСД. Т.е. в процессе работы программы гасятся только те ВСД, у которых дата ТТН не позднее 
			Текущей даты + dOffset.
			E.g. dOffset=0 -- гашение ВСД с датой не позднее сегодня,
			     dOffset=-1 -- гашение ВСД с датой не позднее конца вчерашнего дня (это дает возможность
					   просматривать и выборочно гасить "нестандартные" сегодняшние ВСД вручную,
					   не опасаясь, что VetisKiller их подхватит и погасит раньше времени)

Параметры только для тестового контура Ветис:

ToENGuid=		GUID ХС и предприятия партнера для организации "тестового трафика" ВСД перед получением
ToBEGuid=		доступа к боевому контуру.

============ Пример Vetis.ini (боевой контур): ===================================

iLog=7
XMLHeader=<?xml version="1.0" encoding="UTF-8"?>
Endpoint=https://api.vetrf.ru/platform/services/2.0/ApplicationManagementService
Service=mercury-g2b.service:2.0
ApiLogin=abcd-190904:6Mfk8Kd3L5
MercLogin=ivanova_ev_181205
apikey=ZDAyXzljNmBCOWRiKi01ZTg1LWE2MDQsNDY2ZERlMDBjNmM3NTXwNTExZTAmYWM3OS10Njk3LWE4NzStYjQ1NTkyZDdkYjY8
BusinessEntityGuid=560567e1-bc79-4601-a875-b45594d8db96
EnterpriseGuid=56a07cde-564c-41de-856c-7a80c1dda2a3
DataPath=
NVDList=30
ToENGuid=
ToBEGuid=
dOffset=-1
